<!--
=====================================================================================
ROS-simple-follower 라이다 추적 시스템 런치 파일
=====================================================================================

이 파일은 LIMO 자율주행차에서 라이다 센서를 이용한 물체 추적 시스템을 실행하는
ROS launch 파일입니다. 

시스템 구성:
1. laserTracker 노드: 라이다 데이터에서 가장 가까운 물체 감지
2. follower 노드: 감지된 물체를 PID 제어로 추종

실행 방법:
$ roslaunch simple_follower laser_follower.launch

작성: LIMO 자율주행 교육과정 팀 프로젝트
용도: 라이다 기반 물체 추종 자율주행 데모
=====================================================================================
-->

<launch>
  <group>
    
    <!-- ================================================================== -->
    <!--                    라이다 추적 노드 (LaserTracker)                     -->
    <!-- ================================================================== -->
    
    <node pkg="simple_follower" type="laserTracker.py" name="laserTracker" output="screen">
      
      <!-- 토픽 리매핑: LIMO의 라이다 토픽을 표준 /scan 토픽으로 변경 -->
      <remap from="/hokuyo_base/scan" to="/scan" />
      
      <!-- 노이즈 필터링 파라미터 설정 -->
      
      <!-- winSize: 노이즈 검사를 위한 윈도우 크기
           현재 측정점 기준 좌우로 몇 개의 점을 확인할지 설정
           값이 클수록 더 엄격한 노이즈 필터링, 작을수록 더 민감한 감지
           권장값: 1-3 (LIMO 환경에서는 2가 적절) -->
      <param name="winSize" value="2" type="int" />
      
      <!-- deltaDist: 이전 스캔과 현재 스캔의 허용 거리 차이 (미터)
           이 값보다 거리 차이가 작으면 같은 물체로 인정 (노이즈가 아님)
           값이 클수록 관대한 필터링, 작을수록 엄격한 필터링
           권장값: 0.1-0.3m (실내 환경에서는 0.2m가 적절) -->
      <param name="deltaDist" value="0.2" type="double" />
      
    </node>
    
    
    <!-- ================================================================== -->
    <!--                      물체 추종 노드 (Follower)                        -->
    <!-- ================================================================== -->
    
    <node pkg="simple_follower" type="follower.py" name="follower" output="screen">
      
      <!-- 토픽 리매핑: 내부 토픽을 LIMO 표준 제어 토픽으로 변경 -->
      <remap from="/cmd_vel/yolo" to="/cmd_vel" />
      
      <!-- 기본 제어 파라미터 -->
      
      <!-- switchMode: 제어 모드 설정
           True: 버튼 한 번 누르면 on/off 토글 방식
           False: 버튼을 누르고 있는 동안만 동작
           현재는 조이스틱 사용하지 않으므로 True로 설정 -->
      <param name="switchMode" value="True" type="bool" />
      
      <!-- 속도 및 거리 제어 파라미터 -->
      
      <!-- maxSpeed: 로봇의 최대 이동 속도 (m/s)
           안전을 위해 제한된 속도로 설정
           실내 환경: 0.3-0.5m/s, 실외 환경: 0.5-1.0m/s 권장 -->
      <param name='maxSpeed' value='0.5' type='double' />
      
      <!-- targetDist: 물체와 유지할 목표 거리 (미터)
           로봇이 물체로부터 이 거리만큼 떨어져서 추종
           너무 가까우면 충돌 위험, 너무 멀면 추적 불안정
           권장값: 0.5-1.5m (LIMO 크기를 고려하여 0.5m 설정) -->
      <param name='targetDist' value='0.5' type='double' />
      
      <!-- controllButtonIndex: 조이스틱 제어 버튼 인덱스
           현재는 조이스틱 사용하지 않지만 확장성을 위해 유지
           -4: PS3 컨트롤러의 특정 버튼 인덱스 -->
      <param name='controllButtonIndex' value='-4' type='int' />
      
      <!-- PID 제어기 파라미터 로드 -->
      <!-- PID_controller 네임스페이스에 YAML 파일의 P, I, D 값들을 로드
           이 파라미터들이 추종 성능을 결정하는 핵심 요소
           P: 빠른 응답, I: 정확한 목표 도달, D: 오버슈트 방지 -->
      <rosparam ns='PID_controller' command='load' file='$(find simple_follower)/parameters/PID_param.yaml' />
      
    </node>
    
    <!-- 추가 노드나 설정이 필요한 경우 여기에 포함 가능 -->
    
  </group>
</launch>

<!--
=====================================================================================
파라미터 튜닝 가이드:
=====================================================================================

라이다 추적 성능 향상을 위한 파라미터 조정 방법:

1. 노이즈가 많은 환경:
   - winSize를 3으로 증가
   - deltaDist를 0.1로 감소 (더 엄격한 필터링)

2. 빠른 물체 추적:
   - maxSpeed를 0.7로 증가
   - PID_param.yaml에서 P 값 증가

3. 부드러운 추종:
   - maxSpeed를 0.3으로 감소
   - PID_param.yaml에서 D 값 증가

4. 안전 거리 조정:
   - targetDist를 0.8로 증가 (더 안전)
   - targetDist를 0.3으로 감소 (더 가까운 추종)

실험을 통해 환경에 맞는 최적값을 찾는 것이 중요합니다.
=====================================================================================
-->